#!/usr/bin/env bash
set -euo pipefail

# One-shot helper. Reads prompt from stdin and sends to chosen backend.

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]:-$0}")" && pwd)"
AI_WRAPPER="$SCRIPT_DIR/ai"

if [[ ! -x "$AI_WRAPPER" ]]; then
  echo "Error: unified ai wrapper '$AI_WRAPPER' not found or not executable" >&2
  exit 1
fi

BACKEND="${AI_BACKEND:-openai}"

# Read full prompt from stdin
PROMPT="$(cat)"

if [[ -z "$PROMPT" ]]; then
  echo "Error: no prompt provided on stdin" >&2
  exit 1
fi

"$AI_WRAPPER" "$BACKEND" "$PROMPT"
